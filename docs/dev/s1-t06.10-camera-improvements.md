# T6.10 2D/3D 카메라 전환 개선

## 완료 항목

### 1. EditorState 확장
- `cameraResetCounter` 필드 추가 (카메라 리셋 트리거용)
- 증가할 때마다 카메라가 기본 위치로 복귀

### 2. EditorAction 추가
- `RESET_CAMERA` 액션 추가
- `cameraResetCounter` 증가시켜 리셋 트리거

### 3. 카메라 리셋 기능 구현
- `closet-canvas.tsx`에 `useEffect` 추가
- `cameraResetCounter` 변경 감지 시 OrbitControls target 리셋
- 카메라 컴포넌트에 `key={cameraResetCounter}` 추가하여 React 리마운트 트리거

### 4. OrbitControls 개선
**2D 모드:**
- `enableRotate: false` (회전 불가)
- `maxPolarAngle: 0` (탑뷰 고정)
- `minZoom: 20, maxZoom: 200` (줌 범위 제한)

**3D 모드:**
- `enableRotate: true` (회전 가능)
- `maxPolarAngle: Math.PI / 2.1` (바닥 아래 방지)
- `minDistance: 2, maxDistance: 50` (거리 범위 제한)

### 5. EditorToolbar 업데이트
- 카메라 리셋 버튼 추가 (`RotateCcw` 아이콘)
- 2D/3D 토글 버튼 옆에 배치

### 6. 타입 안정성 개선
- `OrbitControls` ref에 `three-stdlib` 타입 적용
- TypeScript strict 모드 준수

## 주요 결정사항

### 카메라 전환 방식
- R3F의 `makeDefault` 기반 전환 사용 (간단하고 안정적)
- 별도 보간 애니메이션은 추가하지 않음 (즉시 전환이 더 직관적)
- `key` prop으로 React 리마운트 트리거하여 위치 리셋

### 리셋 메커니즘
- 카운터 기반 트리거 (불필요한 상태 추가 방지)
- OrbitControls target 리셋 + 카메라 리마운트 조합

### 제약사항 설정
- 2D: 줌 범위 20-200 (적절한 작업 거리 유지)
- 3D: 거리 범위 2-50, polar angle 제한 (바닥 투과 방지)

## 부수적인 수정

### 빌드 에러 수정
작업 중 발견된 타입 에러들을 수정:

1. **src/app/api/pdf/route.ts** (2곳)
   - Supabase join 결과가 배열로 추론되는 문제
   - Runtime check 후 type assertion 추가

2. **src/components/closet/parts-palette.tsx**
   - `preset_data`의 타입이 `unknown`으로 추론되는 문제
   - 명시적 타입 단언 추가

3. **next.config.ts**
   - Serwist PWA 빌드 오류 해결
   - `disable: process.env.NODE_ENV === 'development'` 추가

## 검증 결과

### 빌드 성공
```
npm run build ✓
```

### TypeScript 진단
- `closet-canvas.tsx`: No diagnostics ✓
- `editor-context.tsx`: No diagnostics ✓
- `closet-editor.ts`: No diagnostics ✓
- `editor-toolbar.tsx`: No diagnostics ✓

### 기능 구현 완료
- [x] 2D/3D 카메라 전환
- [x] 모드별 최적화된 OrbitControls
- [x] 카메라 리셋 버튼
- [x] 줌/거리/각도 제한
- [x] OrbitControls target 리셋

## 다음 단계

- T6.8: 드래그 앤 드롭 컴포넌트 배치 기능 (다른 executor에서 진행 중)
- T6.11: 프리셋 저장/로드 기능
- 사용자 테스트 후 카메라 전환 애니메이션 필요 여부 재검토

## 수정된 파일

- `src/lib/types/closet-editor.ts` (EditorState 확장)
- `src/components/closet/editor-context.tsx` (RESET_CAMERA 액션)
- `src/components/closet/closet-canvas.tsx` (카메라 리셋 로직, OrbitControls 개선)
- `src/components/closet/editor-toolbar.tsx` (리셋 버튼 추가)
- `src/app/api/pdf/route.ts` (타입 에러 수정)
- `src/components/closet/parts-palette.tsx` (타입 에러 수정)
- `next.config.ts` (Serwist 빌드 오류 수정)
