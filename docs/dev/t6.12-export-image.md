# T6.12 모델 이미지 내보내기 (PNG)

**완료 일시**: 2026-02-14
**작업자**: Executor Agent

## 완료 항목

### 1. Canvas preserveDrawingBuffer 활성화
- **파일**: `src/components/closet/closet-canvas.tsx`
- Canvas의 `gl` prop에 `preserveDrawingBuffer: true` 추가
- PNG 내보내기를 위한 canvas 픽셀 버퍼 보존 설정

### 2. ExportImageButton 컴포넌트 생성
- **파일**: `src/components/closet/export-image-button.tsx`
- 기능:
  - canvas 요소를 찾아 PNG 데이터 URL 생성
  - 타임스탬프가 포함된 파일명으로 다운로드 링크 생성
  - 성공/실패 토스트 알림 (sonner 사용)
  - 내보내기 중 버튼 비활성화 처리
- UI:
  - Download 아이콘 (lucide-react)
  - 반응형: 데스크톱에서 "내보내기" 텍스트 표시
  - ghost 스타일, xs 크기

### 3. EditorToolbar 통합
- **파일**: `src/components/closet/editor-toolbar.tsx`
- ExportImageButton import 추가
- Grid sizes 섹션과 Spacer 사이에 배치:
  - Separator 추가
  - ExportImageButton 추가
- 최종 순서:
  ```
  Mobile palette | Camera | Reset | Snap | Dimensions | Grid | Export | [spacer] | Selected info + delete
  ```

## 주요 결정사항

### 파일명 형식
- 형식: `closet-model-{timestamp}.png`
- 타임스탬프로 고유성 보장, 기본 다운로드 동작 사용

### 에러 처리
- canvas 요소가 없을 경우: "캔버스를 찾을 수 없습니다." 에러 토스트
- 내보내기 실패 시: "이미지 내보내기에 실패했습니다." 에러 토스트
- 콘솔 에러 로그 출력

### UI 배치
- 그리드 크기 설정 바로 뒤에 배치 (툴바 오른쪽 영역에 진입하기 전)
- Separator로 명확하게 그룹 분리
- 선택된 컴포넌트 정보와 물리적으로 분리하여 혼동 방지

## 빌드 확인

```bash
npm run build
```

**결과**: ✅ 성공
- 타입 체크 통과
- ESLint 통과 (기존 경고만 존재, 본 변경과 무관)
- 프로덕션 빌드 생성 완료

## 테스트 권장사항

### 수동 테스트
1. 클로젯 에디터 페이지 접속
2. 부품을 몇 개 배치
3. 2D/3D 뷰 전환 후 각각에서 내보내기 버튼 클릭
4. PNG 파일 다운로드 확인
5. 다운로드된 이미지 품질 확인 (해상도, 배경색)
6. 다크모드/라이트모드에서 각각 테스트

### 엣지 케이스
- canvas가 아직 렌더링되지 않은 상태에서 버튼 클릭 (이론적 시나리오)
- 매우 큰 모델 (성능 확인)
- 빈 캔버스 내보내기

## 다음 단계

- T6.13: 모델 저장/불러오기 (로컬 스토리지 또는 파일 시스템)
- T6.14: 프리셋 갤러리 페이지 구현
- T6.15: 모델 공유 기능 (URL 또는 이미지 공유)

## 알려진 이슈

없음.

## 참고사항

- `preserveDrawingBuffer: true` 설정은 약간의 메모리 오버헤드가 있을 수 있으나, 내보내기 기능을 위해 필수
- canvas.toDataURL()은 동기 메서드이나 대부분의 경우 충분히 빠름
- 추후 고해상도 내보내기 (2x, 4x) 옵션 추가 고려 가능
